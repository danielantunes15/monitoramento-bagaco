<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEL FIRE - Protocolos de Emergência</title>
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="css/protocols.css"> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
</head>
<body class="dark-mode">

    <nav class="sidebar">
        <div class="logo-container">
            <div class="logo-icon"><i class="fas fa-fire-extinguisher"></i></div>
            <div class="logo-text"><h1>BEL FIRE</h1><p class="subtitle">Enterprise Edition</p></div>
        </div>
        
        <div class="menu-items">
            <a href="index.html" class="menu-item"><i class="fas fa-video"></i><span>Câmeras</span></a>
            <a href="dashboard.html" class="menu-item"><i class="fas fa-chart-pie"></i><span>Dashboard</span></a>
            <a href="monitor3d.html" class="menu-item"><i class="fas fa-cube"></i><span>Digital Twin 3D</span></a>
            <a href="protocols.html" class="menu-item active"><i class="fas fa-file-medical-alt"></i><span>Protocolos</span></a>
            <a href="cameras.html" class="menu-item"><i class="fas fa-expand"></i><span>Tela Cheia</span></a>
            <a href="settings.html" class="menu-item"><i class="fas fa-cogs"></i><span>Configurações</span></a>
        </div>
        
        <div class="system-status">
            <div class="status-indicator active"><div class="status-dot"></div><span>Online</span></div>
            <div class="current-time" id="current-time">--:--:--</div>
        </div>
    </nav>

    <main class="main-content">
        <header class="top-header">
            <div class="header-title">
                <h2><i class="fas fa-file-medical-alt"></i> Gestão de Crise e Protocolos</h2>
                <p class="page-description">Matriz de escalonamento de emergência</p>
            </div>
            <div class="header-controls">
                 <button class="btn-control" onclick="protocolSystem.openSettings()"><i class="fas fa-cog"></i> Configurar Rádio</button>
                 <div class="user-profile">
                    <div class="avatar">OP</div>
                    <span>Operador</span>
                </div>
            </div>
        </header>

        <div class="content-wrapper">
            
            <div id="active-protocol-banner" style="display:none; background: linear-gradient(90deg, #7f1d1d, #991b1b); padding: 15px; border-radius: 8px; margin-bottom: 20px; align-items: center; justify-content: space-between; border: 1px solid #ef4444;">
                <div style="color: white; font-weight: bold;">
                    <i class="fas fa-exclamation-triangle fa-lg" style="margin-right: 10px;"></i>
                    PROTOCOLO EM ANDAMENTO: <span id="banner-phase">NÍVEL 0</span>
                </div>
                <button class="btn-sm" style="background: white; color: #991b1b; border:none; font-weight:bold;" onclick="protocolSystem.resetProtocol()">ENCERRAR</button>
            </div>

            <div class="protocol-container">
                <div class="protocol-grid">
                    
                    <div class="phase-card active" id="phase-1" data-phase="1">
                        <div class="phase-badge">1</div>
                        <div class="phase-header">
                            <h2>Anomalia Identificada</h2>
                            <span class="phase-role">Nível Operacional</span>
                        </div>
                        <p>O sistema identificou variações térmicas anormais. Notificação imediata para equipe de campo.</p>
                        <div class="contact-list">
                            <div class="contact-item"><i class="fas fa-user-hard-hat"></i> Supervisor Industrial</div>
                            <div class="contact-item"><i class="fas fa-user-shield"></i> Técnico de Seg. (TST)</div>
                        </div>
                        <button class="action-btn btn-activate" onclick="protocolSystem.confirmTrigger(1)">
                            <i class="fas fa-bell"></i> Confirmar Alerta Automático
                        </button>
                    </div>

                    <div class="phase-card" id="phase-2" data-phase="2">
                        <div class="phase-badge">2</div>
                        <div class="phase-header">
                            <h2>Princípio de Incêndio</h2>
                            <span class="phase-role">Nível Tático</span>
                        </div>
                        <p>Confirmação visual de fumaça ou fogo. Mobilização da brigada interna.</p>
                        <div class="contact-list">
                            <div class="contact-item"><i class="fas fa-fire-extinguisher"></i> Líder da Brigada</div>
                            <div class="contact-item"><i class="fas fa-users"></i> Equipe de Brigada</div>
                        </div>
                        <button class="action-btn btn-activate" onclick="protocolSystem.confirmTrigger(2)">
                            <i class="fas fa-bullhorn"></i> Acionar Brigada
                        </button>
                    </div>

                    <div class="phase-card" id="phase-3" data-phase="3">
                        <div class="phase-badge">3</div>
                        <div class="phase-header">
                            <h2>Incêndio em Progresso</h2>
                            <span class="phase-role">Nível Estratégico</span>
                        </div>
                        <p>Brigada não controlou o foco inicial. Risco ao patrimônio e operações.</p>
                        <div class="contact-list">
                            <div class="contact-item"><i class="fas fa-user-tie"></i> Diretoria Bahia Etanol</div>
                            <div class="contact-item"><i class="fas fa-user-friends"></i> Liderança BEL</div>
                            <div class="contact-item"><i class="fas fa-helmet-safety"></i> Coordenador de SSMA</div>
                        </div>
                        <button class="action-btn btn-activate" onclick="protocolSystem.confirmTrigger(3)">
                            <i class="fas fa-phone"></i> Notificar Liderança
                        </button>
                    </div>

                    <div class="phase-card" id="phase-4" data-phase="4">
                        <div class="phase-badge">4</div>
                        <div class="phase-header">
                            <h2>CRÍTICO / EVACUAÇÃO</h2>
                            <span class="phase-role">Apoio Externo</span>
                        </div>
                        <p>Perda de controle operacional. Acionamento de autoridades públicas.</p>
                        <div class="contact-list">
                            <div class="contact-item"><i class="fas fa-truck-medical"></i> Corpo de Bombeiros (193)</div>
                            <div class="contact-item"><i class="fas fa-hands-helping"></i> PAM (Plano de Auxílio Mútuo)</div>
                        </div>
                        
                        <button class="action-btn btn-activate" onclick="protocolSystem.confirmTrigger(4)">
                            <i class="fas fa-radiation-alt"></i> Chamar Bombeiros (CBM)
                        </button>

                        <div id="fire-integration-ui" style="display: none; margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.4); border: 2px dashed #ef4444; border-radius: 8px;">
                            <h3 style="color: #ef4444; margin-top:0;"><i class="fas fa-link"></i> Integração com Viatura</h3>
                            <p style="font-size: 14px; color: #cbd5e1; margin-bottom: 15px;">
                                Link de dados seguro gerado. Compartilhe com o comandante da operação para acesso à planta e rotas.
                            </p>
                            <button class="action-btn" style="background: #ef4444; color: white;" onclick="window.open('emergency.html', '_blank')">
                                <i class="fas fa-external-link-alt"></i> ABRIR VISÃO DE RESGATE
                            </button>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-circle"></i> Confirmar Acionamento</h3>
                <button class="close-modal" id="close-confirm-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p>Você está prestes a iniciar o <strong>Protocolo Nível <span id="modal-level-num"></span></strong>.</p>
                <p style="color:var(--text-muted); font-size:14px; margin-top:10px;">Esta ação enviará alertas automáticos para as equipes responsáveis e registrará o evento nos logs de auditoria.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-trigger">Cancelar</button>
                <button class="btn-primary" id="btn-do-trigger" style="background:var(--danger-color);">CONFIRMAR E ALERTAR</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="radio-modal" style="z-index: 9999;">
        <div class="modal-content" style="border: 2px solid #f59e0b;">
            <div class="modal-header" style="background: rgba(245, 158, 11, 0.1);">
                <h3 style="color:#f59e0b"><i class="fas fa-broadcast-tower"></i> Confirmação via Rádio</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:15px;">O sistema detectou falha na notificação automática ou o protocolo exige <strong>confirmação verbal positiva</strong>.</p>
                
                <div class="radio-check-item">
                    <span class="radio-freq" id="radio-channel-display">CANAL 5</span>
                    <p>Contatar: <strong id="radio-contact-display">Supervisor</strong></p>
                    <p style="font-size:13px; margin-top:5px;">Fraseologia: <em>"Atenção, aqui é o Operador. Protocolo Nível <span id="radio-level-display">X</span> iniciado. Confirme recebimento."</em></p>
                </div>

                <div style="margin-top:20px; padding:10px; background:rgba(0,0,0,0.2); border-radius:6px;">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="radio-confirmed-check" style="width:18px; height:18px; margin-right:10px;">
                        <span>Confirmo que realizei o contato via rádio e obtive resposta positiva.</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="protocolSystem.closeRadioModal()">Não Consegui Contato</button>
                <button class="btn-primary" onclick="protocolSystem.confirmRadioAction()" id="btn-confirm-radio" disabled>Registrar Confirmação</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cogs"></i> Configurações de Protocolo</h3>
                <button class="close-modal" onclick="protocolSystem.closeSettings()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px;">Canal de Rádio Principal</label>
                    <input type="text" id="conf-channel" value="CANAL 5" style="width:100%; padding:10px; background:var(--bg-body); border:1px solid var(--border-color); color:white; border-radius:6px;">
                </div>
                <div class="form-group" style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px;">Responsável (Contato)</label>
                    <input type="text" id="conf-contact" value="Supervisor de Turno" style="width:100%; padding:10px; background:var(--bg-body); border:1px solid var(--border-color); color:white; border-radius:6px;">
                </div>
                <div class="form-group" style="margin-bottom:15px; padding:10px; background:rgba(239,68,68,0.1); border-radius:6px;">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="conf-force-radio" style="margin-right:10px;">
                        <span>Sempre exigir confirmação de rádio (Modo Rigoroso)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="conf-sim-fail" style="margin-right:10px;">
                        <span>Simular Falha de Rede (Para Teste)</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="protocolSystem.closeSettings()">Cancelar</button>
                <button class="btn-primary" onclick="protocolSystem.saveSettings()">Salvar</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/protocols.js"></script>
</body>
</html>